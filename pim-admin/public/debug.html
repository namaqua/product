<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Frontend Debug</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
        pre {
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            overflow: auto;
        }
    </style>
</head>
<body>
    <h1>Frontend Debug Console</h1>
    
    <div>
        <button onclick="checkFrontend()">Check Frontend Status</button>
        <button onclick="checkAuth()">Check Auth</button>
        <button onclick="clearStorage()">Clear Local Storage</button>
        <button onclick="testAPI()">Test API</button>
    </div>
    
    <pre id="output"></pre>
    
    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<span class="${type}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        }
        
        async function checkFrontend() {
            log('Checking frontend at http://localhost:5173...', 'info');
            
            try {
                const response = await fetch('http://localhost:5173/');
                const text = await response.text();
                
                if (text.includes('Loading React')) {
                    log('Frontend HTML loaded but React not mounting', 'error');
                    log('Fetching page to check for errors...', 'info');
                    
                    // Try to fetch the actual app
                    const appResponse = await fetch('http://localhost:5173/src/main.tsx');
                    log('main.tsx status: ' + appResponse.status, appResponse.ok ? 'success' : 'error');
                } else if (text.includes('root')) {
                    log('Frontend HTML loaded successfully', 'success');
                }
                
                // Check if Vite is responding
                const viteResponse = await fetch('http://localhost:5173/@vite/client');
                log('Vite client: ' + (viteResponse.ok ? 'OK' : 'NOT OK'), viteResponse.ok ? 'success' : 'error');
                
            } catch (error) {
                log('Frontend not accessible: ' + error.message, 'error');
            }
        }
        
        function checkAuth() {
            log('Checking authentication state...', 'info');
            
            const token = localStorage.getItem('access_token');
            const authStorage = localStorage.getItem('auth-storage');
            
            if (token) {
                log('Access token found: ' + token.substring(0, 20) + '...', 'success');
            } else {
                log('No access token found', 'error');
            }
            
            if (authStorage) {
                try {
                    const auth = JSON.parse(authStorage);
                    log('Auth state: ' + JSON.stringify(auth.state, null, 2), 'info');
                } catch (e) {
                    log('Failed to parse auth storage', 'error');
                }
            } else {
                log('No auth storage found', 'info');
            }
        }
        
        function clearStorage() {
            localStorage.clear();
            sessionStorage.clear();
            log('Local storage and session storage cleared', 'success');
            log('Reload the page at http://localhost:5173 to start fresh', 'info');
        }
        
        async function testAPI() {
            log('Testing API at http://localhost:3010/api/v1...', 'info');
            
            try {
                const response = await fetch('http://localhost:3010/api/v1/health');
                const data = await response.json();
                log('API Health: ' + JSON.stringify(data), 'success');
            } catch (error) {
                log('API not accessible: ' + error.message, 'error');
            }
            
            // Test with auth
            const token = localStorage.getItem('access_token');
            if (token) {
                try {
                    const response = await fetch('http://localhost:3010/api/v1/products', {
                        headers: {
                            'Authorization': 'Bearer ' + token
                        }
                    });
                    const data = await response.json();
                    log('Products endpoint: ' + response.status + ' - ' + (data.success ? 'SUCCESS' : 'FAILED'), 
                        response.ok ? 'success' : 'error');
                } catch (error) {
                    log('Products endpoint error: ' + error.message, 'error');
                }
            }
        }
        
        // Auto-run on load
        checkFrontend();
    </script>
</body>
</html>
